# ArgoCD-Driven Application Vision

## Core Concept

**Config Hub is an ArgoCD-driven GitOps UI** where ArgoCD ApplicationSets are the source of truth, and all configuration management flows through Git PRs.

## Architecture Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ArgoCD Server                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         ApplicationSet Controller                     â”‚   â”‚
â”‚  â”‚  Generates â†’ App1, App2, App3, ... AppN             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    Config Hub discovers
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Config Hub UI                           â”‚
â”‚                                                              â”‚
â”‚  For each ArgoCD Application:                               â”‚
â”‚  â”œâ”€ Auto-discover Git source(s)                            â”‚
â”‚  â”œâ”€ Auto-configure Git credentials                         â”‚
â”‚  â”œâ”€ Provide editing flows:                                 â”‚
â”‚  â”‚  â”œâ”€ Config Values (values.yaml, config files)          â”‚
â”‚  â”‚  â”œâ”€ Secrets (Kubernetes Secrets)                       â”‚
â”‚  â”‚  â””â”€ External Secrets (Vault integration)               â”‚
â”‚  â””â”€ All changes â†’ Git PR                                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    All flows result in
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Pull Request                              â”‚
â”‚  â”œâ”€ Config changes                                          â”‚
â”‚  â”œâ”€ Secret changes                                          â”‚
â”‚  â”œâ”€ External Secret references                              â”‚
â”‚  â””â”€ Review â†’ Merge â†’ ArgoCD syncs                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Principles

### 1. ArgoCD as Source of Truth
- **Discovery**: Config Hub discovers applications from ArgoCD
- **No Manual Config**: Don't manually configure apps - they come from ArgoCD
- **ApplicationSet Driven**: Support apps generated by ApplicationSets
- **Multi-Source**: Handle apps with multiple Git sources

### 2. Git-Centric Workflow
- **Everything via PR**: All changes go through Pull Requests
- **No Direct Apply**: Never apply changes directly to cluster
- **GitOps Compliance**: Maintain full audit trail
- **Review Process**: Changes must be reviewed before merge

### 3. Unified Editing Flows

#### Flow A: Configuration Values
```
User â†’ Browse App â†’ Edit Config â†’ Preview Changes â†’ Create PR
                                                        â†“
                                              Review â†’ Merge â†’ ArgoCD Syncs
```

#### Flow B: Secrets Management
```
User â†’ Browse App â†’ Edit Secret â†’ Encrypt/Store â†’ Create PR
                                                      â†“
                                            Review â†’ Merge â†’ ArgoCD Syncs
```

#### Flow C: External Secrets (Vault)
```
User â†’ Browse App â†’ Configure External Secret â†’ Update Vault â†’ Create PR
                                                                   â†“
                                                         Review â†’ Merge â†’ ArgoCD Syncs
```

## Detailed Workflows

### Configuration Values Flow

```typescript
interface ConfigEditFlow {
  // 1. Discovery
  discoverFromArgoCD: () => {
    application: ArgoCDApplication
    gitSources: GitSource[]  // Can be multiple!
    configFiles: ConfigFile[]
  }
  
  // 2. Editing
  editConfig: (file: ConfigFile) => {
    // Smart editor based on file type
    // - YAML editor for values.yaml
    // - JSON editor for config.json
    // - Text editor for others
    // - Syntax validation
    // - Schema validation (if available)
  }
  
  // 3. Preview
  previewChanges: () => {
    diff: string
    affectedResources: K8sResource[]
    validationResults: ValidationResult[]
  }
  
  // 4. PR Creation
  createPR: () => {
    branch: string
    title: string
    description: string  // Auto-generated with change summary
    reviewers: string[]
  }
}
```

### Secrets Management Flow

```typescript
interface SecretEditFlow {
  // 1. Discovery
  discoverSecrets: () => {
    secrets: K8sSecret[]
    externalSecrets: ExternalSecret[]
    vaultPaths: VaultPath[]
  }
  
  // 2. Editing Options
  editSecret: (secret: K8sSecret) => {
    // Option A: Direct Secret (encrypted in Git)
    encryptValue: (value: string) => string  // Using sealed-secrets or SOPS
    
    // Option B: External Secret (reference to Vault)
    createVaultReference: (vaultPath: string) => ExternalSecretSpec
  }
  
  // 3. Vault Integration
  vaultOperations: {
    // Store secret in Vault
    storeInVault: (path: string, value: string) => void
    
    // Create External Secret manifest
    createExternalSecret: (spec: ExternalSecretSpec) => string
    
    // Validate Vault access
    validateVaultPath: (path: string) => boolean
  }
  
  // 4. PR Creation
  createPR: () => {
    // PR includes:
    // - Secret manifest (encrypted or external secret ref)
    // - Vault path documentation
    // - Security review checklist
  }
}
```

### External Secrets Flow

```typescript
interface ExternalSecretFlow {
  // 1. Vault Setup
  configureVault: () => {
    vaultConnection: VaultConnection
    mountPath: string
    secretPath: string
  }
  
  // 2. Secret Mapping
  mapSecrets: () => {
    // Map Vault secrets to K8s secret keys
    mapping: {
      vaultKey: string
      k8sKey: string
      transformation?: string
    }[]
  }
  
  // 3. External Secret Manifest
  generateManifest: () => {
    apiVersion: "external-secrets.io/v1beta1"
    kind: "ExternalSecret"
    spec: {
      secretStoreRef: VaultSecretStore
      target: K8sSecret
      data: SecretMapping[]
    }
  }
  
  // 4. Dual Operation
  createExternalSecret: () => {
    // Step 1: Store in Vault
    vaultClient.write(path, data)
    
    // Step 2: Create External Secret manifest
    manifest = generateManifest()
    
    // Step 3: Create PR with manifest
    createPR(manifest)
  }
}
```

## UI Structure

### Main Navigation
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Config Hub                                    [Sync ArgoCD] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ðŸ“± Applications (from ArgoCD)                               â”‚
â”‚  â”œâ”€ ðŸŸ¢ platform-infrastructure-dev                          â”‚
â”‚  â”œâ”€ ðŸŸ¢ platform-infrastructure-prod                         â”‚
â”‚  â”œâ”€ ðŸŸ¢ api-gateway-dev                                      â”‚
â”‚  â””â”€ ðŸŸ¡ legacy-app-dev (needs attention)                     â”‚
â”‚                                                              â”‚
â”‚  ðŸ”§ Settings                                                 â”‚
â”‚  â”œâ”€ ArgoCD Connections                                      â”‚
â”‚  â”œâ”€ Git Credentials (auto-configured)                       â”‚
â”‚  â””â”€ Vault Connections                                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Application Detail View
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  platform-infrastructure-dev                    [Sync] [â‹®]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ðŸ“Š Status                                                   â”‚
â”‚  â”œâ”€ Sync: âœ… Synced (2 minutes ago)                         â”‚
â”‚  â”œâ”€ Health: âœ… Healthy                                      â”‚
â”‚  â””â”€ Git: abc123 - "Update config" (main)                   â”‚
â”‚                                                              â”‚
â”‚  ðŸ“ Configuration                                            â”‚
â”‚  â”œâ”€ values.yaml                    [Edit] [History]         â”‚
â”‚  â”œâ”€ config/app.yaml               [Edit] [History]         â”‚
â”‚  â””â”€ config/database.yaml          [Edit] [History]         â”‚
â”‚                                                              â”‚
â”‚  ðŸ” Secrets                                                  â”‚
â”‚  â”œâ”€ api-keys (External Secret â†’ Vault)  [Edit]             â”‚
â”‚  â”œâ”€ database-password (Sealed Secret)   [Edit]             â”‚
â”‚  â””â”€ tls-cert (K8s Secret)               [Edit]             â”‚
â”‚                                                              â”‚
â”‚  ðŸ”„ Pull Requests                                            â”‚
â”‚  â”œâ”€ #123 Update API timeout (Open)                         â”‚
â”‚  â””â”€ #122 Add new feature flag (Merged)                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Config Editor
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edit: values.yaml                          [Cancel] [Save]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Editor                 â”‚ Preview                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ replicaCount: 3        â”‚ Changes:                    â”‚   â”‚
â”‚  â”‚ image:                 â”‚ + replicaCount: 2 â†’ 3       â”‚   â”‚
â”‚  â”‚   repository: nginx    â”‚ + resources.limits.memory   â”‚   â”‚
â”‚  â”‚   tag: "1.21"          â”‚                             â”‚   â”‚
â”‚  â”‚ resources:             â”‚ Affected Resources:         â”‚   â”‚
â”‚  â”‚   limits:              â”‚ â€¢ Deployment/app            â”‚   â”‚
â”‚  â”‚     memory: 512Mi      â”‚ â€¢ HPA/app-hpa               â”‚   â”‚
â”‚  â”‚     cpu: 500m          â”‚                             â”‚   â”‚
â”‚  â”‚                        â”‚ Validation: âœ… Valid        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  [Create Pull Request]                                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Secret Editor
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edit Secret: api-keys                      [Cancel] [Save]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Secret Type: [External Secret â–¼]                           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€ Vault Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Vault Path: secret/data/platform/api-keys            â”‚  â”‚
â”‚  â”‚ Mount Path: secret                                    â”‚  â”‚
â”‚  â”‚ Connection: âœ… Connected                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€ Secret Mapping â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Vault Key          â†’ K8s Key                          â”‚  â”‚
â”‚  â”‚ â”œâ”€ stripe_key      â†’ STRIPE_API_KEY                  â”‚  â”‚
â”‚  â”‚ â”œâ”€ sendgrid_key    â†’ SENDGRID_API_KEY                â”‚  â”‚
â”‚  â”‚ â””â”€ jwt_secret      â†’ JWT_SECRET                       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚ [+ Add Mapping]                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â˜ Store values in Vault now                          â”‚  â”‚
â”‚  â”‚ â˜‘ Create External Secret manifest                    â”‚  â”‚
â”‚  â”‚ â˜‘ Create Pull Request                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  [Save & Create PR]                                          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Implementation Phases

### Phase 1: ArgoCD Discovery âœ… (Partially Done)
- [x] Connect to ArgoCD
- [x] List applications
- [x] Get application details
- [ ] Auto-discover Git sources from app spec
- [ ] Handle multi-source applications
- [ ] Support ApplicationSets

### Phase 2: Git Integration âœ… (Done)
- [x] Git credential management
- [x] Browse repository files
- [x] Create branches
- [x] Create commits
- [x] Create Pull Requests
- [x] View PR diffs
- [x] Approve and merge PRs

### Phase 3: Config Editing (In Progress)
- [x] Parameter editor (basic)
- [ ] YAML editor with validation
- [ ] Preview changes
- [ ] Diff view
- [ ] Auto-generate PR descriptions

### Phase 4: Secrets Management (TODO)
- [ ] Discover secrets in application
- [ ] Sealed Secrets support
- [ ] SOPS support
- [ ] Secret editor UI

### Phase 5: External Secrets + Vault (TODO)
- [ ] Vault connection management
- [ ] External Secret discovery
- [ ] Secret mapping UI
- [ ] Dual operation (Vault + Git PR)
- [ ] Vault path validation

### Phase 6: Unified Experience (TODO)
- [ ] Auto-configure Git from ArgoCD app
- [ ] Smart credential matching
- [ ] Application-centric navigation
- [ ] Unified status dashboard

## Key Technical Decisions

### 1. ArgoCD as Primary Source
```typescript
// On app startup or refresh
async function syncFromArgoCD() {
  const apps = await argocd.listApplications()
  
  for (const app of apps) {
    // Extract Git sources
    const gitSources = extractGitSources(app.spec.sources)
    
    // Auto-configure or match Git credentials
    for (const source of gitSources) {
      const credential = await findOrCreateGitCredential(source.repoURL)
      
      // Link app to credential
      linkApplicationToCredential(app.name, credential.id)
    }
  }
}
```

### 2. Multi-Source Support
```typescript
interface ArgoCDApplication {
  spec: {
    // Single source (legacy)
    source?: GitSource
    
    // Multi-source (new)
    sources?: GitSource[]
  }
}

// Handle both patterns
function getGitSources(app: ArgoCDApplication): GitSource[] {
  if (app.spec.sources) {
    return app.spec.sources.filter(s => s.repoURL)
  }
  if (app.spec.source) {
    return [app.spec.source]
  }
  return []
}
```

### 3. Secret Type Detection
```typescript
function detectSecretType(manifest: any): SecretType {
  if (manifest.kind === 'ExternalSecret') {
    return 'external-secret'
  }
  if (manifest.kind === 'SealedSecret') {
    return 'sealed-secret'
  }
  if (manifest.kind === 'Secret' && manifest.metadata?.annotations?.['sops']) {
    return 'sops-secret'
  }
  return 'kubernetes-secret'
}
```

## Success Metrics

1. **Zero Manual Git Config**: All Git credentials auto-configured from ArgoCD
2. **PR-First**: 100% of changes go through PRs
3. **Secrets Coverage**: Support all secret types (K8s, Sealed, SOPS, External)
4. **Vault Integration**: Seamless Vault + Git workflow
5. **User Efficiency**: Edit â†’ PR in < 5 clicks

## Next Steps

1. **Commit current work** âœ…
2. **Brainstorm refinements** (now)
3. **Implement ArgoCD auto-discovery**
4. **Build unified application view**
5. **Add secrets management**
6. **Integrate Vault + External Secrets**

This is the complete vision - an ArgoCD-driven GitOps UI where everything flows naturally from your ApplicationSets!
